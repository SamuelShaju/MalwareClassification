from flask import Flask , render_template, request, url_for, redirect
from Model import predict
import os
from werkzeug.utils import secure_filename

app = Flask(__name__)
app.config['UPLOAD_FOLDER'] = './uploads'



@app.route("/",methods=["POST","GET"])
def upload_file():
    username = "malware1"
    print("1")
    if request.method=="POST":
        print("2")
        print(request.files)
        if 'file' not in request.files:
            print("3")
            # flash('No File Found')
            return render_template("form.html")
        print("4")
        print(request.files)
        file = request.files['file']
        if file.filename == "":
            print("5")
            # flash('No File Uploaded')
            return render_template("form.html")
        print("6")
        file.save(os.path.join(app.config['UPLOAD_FOLDER'], 'malware1'))

        print("7")
        prediction = predict()
        print(prediction)
        print("8")
        return render_template("form.html", name=username, pred = prediction[0][0]*100)
    else:
        username = ""
        prediction = ""
        return render_template("form.html", name=username, pred = prediction)
